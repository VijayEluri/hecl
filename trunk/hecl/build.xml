<project name="Hecl" default="build" basedir=".">
  <description>
    Hecl build file.
  </description>
  <!--
  additional properties are read from "build.properties" file
  which can be created as machine-dependant parameters.
  -->
  <property file="build.properties"/>

  <path id="buildclasspath">
    <pathelement location="build/core"/>
  </path>

  <path id="filesclasspath">
    <pathelement location="build/files"/>
  </path>

  <path id="http_standardclasspath">
    <pathelement location="build/http_standard"/>
  </path>

  <!--
  Additional classpath locations, specified in build.properties file
  -->
  <path id="classpath">
  </path>

  <!-- virtual targets -->
  <target name="clean" description="Clean the build"
    depends="cleanOut,cleanBuild,cleanClasses">
    <delete file="Hecl.jar"/>
  </target>

  <target name="build" description="Complete build"
    depends="compile,package"/>

  <target name="compile" description="Complete everything"
    depends="compileCore,compileCommandline,compileApplet"/>

  <target name="package" description="Package things into JARs"
    depends="packageJARs,packageApplet,packageJ2MEtest"/>

  <!-- clean targets -->
  <target name="cleanOut" description="Clean out directory">
    <delete dir="out"/>
  </target>
  <target name="cleanBuild" description="Clean build files">
    <delete dir="build"/>
  </target>
  <target name="cleanClasses" description="Clean Eclipse classes files">
    <delete dir="classes"/>
  </target>

  <!-- compile targets -->
  <target name="initCompile" description="Initialize compilation">
    <mkdir dir="build" />
  </target>

  <target name="compileCore"
    depends="initCompile"
    description="Compile core Hecl functionality">
    <mkdir dir="build" />
    <mkdir dir="build/core" />
    <javac srcdir="core" destdir="build/core">
      <classpath refid="classpath"/>
    </javac>
  </target>

  <target name="compileApplet"
    depends="initCompile,compileCore"
    description="Compile Hecl applet">
    <mkdir dir="build"/>
    <mkdir dir="build/applet"/>
    <javac srcdir="applet" destdir="build/applet">
      <classpath refid="buildclasspath"/>
      <classpath refid="classpath"/>
    </javac>
  </target>

  <target name="compileFiles"
    depends="initCompile,compileCore"
    description="Compile Hecl files support">
    <mkdir dir="build"/>
    <mkdir dir="build/files"/>
    <javac srcdir="files" destdir="build/files" debug="true">
      <classpath refid="buildclasspath"/>
      <classpath refid="classpath"/>
    </javac>
  </target>

  <target name="compileHttpStandard"
    depends="initCompile,compileCore"
    description="Compile J2SE Hecl http support">
    <mkdir dir="build"/>
    <mkdir dir="build/http_standard"/>

    <javac destdir="build/http_standard" debug="true">
      <src path="http"/>
      <src path="http_standard"/>
      <classpath refid="buildclasspath"/>
      <classpath refid="classpath"/>
    </javac>
  </target>


  <target name="compileHttpMicro"
    depends="initCompile,compileCore"
    description="Compile J2ME Hecl http support">
    <mkdir dir="build"/>
    <mkdir dir="build/http_micro"/>

    <javac destdir="build/http_micro" debug="true">
      <src path="http"/>
      <src path="http_micro"/>
      <classpath refid="buildclasspath"/>
      <classpath refid="classpath"/>
    </javac>
  </target>


<!--
  <target name="compilePjava"
    depends="initCompile,compileCore"
    description="Compile Hecl Pjava support">
    <mkdir dir="build"/>
    <mkdir dir="build/pjava"/>
    <javac srcdir="pjava" destdir="build/pjava" debug="true">
      <classpath refid="buildclasspath"/>
      <classpath refid="classpath"/>
    </javac>
  </target>
-->

  <target name="compileCommandline"
    depends="initCompile,compileCore,compileFiles,compileHttpStandard"
    description="Compile Hecl command line support">
    <mkdir dir="build"/>
    <mkdir dir="build/commandline"/>
    <javac srcdir="commandline" destdir="build/commandline" debug="true">
      <classpath refid="filesclasspath"/>
      <classpath refid="http_standardclasspath"/>
      <classpath refid="buildclasspath"/>
      <classpath refid="classpath"/>
    </javac>
  </target>

  <!-- package targsts -->
  <target name="initPackage"
    description="Initialized packaging">
    <mkdir dir="out"/>
  </target>

  <!-- Build the command line package.  We first add the core stuff,
  then add the Hecl command line target. -->
  <target name="packageCommandline" description="Create Jar for command line Hecl" depends="compileCommandline,compileHttpStandard">
    <jar destfile="Hecl.jar" basedir="build/core" update="true"/>
    <jar destfile="Hecl.jar" basedir="build/files" update="true"/>
    <jar destfile="Hecl.jar" basedir="build/http_standard" update="true"/>
    <jar destfile="Hecl.jar" basedir="build/commandline" includes="Hecl.class" update="true">
      <manifest>
        <attribute name="Main-Class" value="Hecl"/>
      </manifest>
    </jar>
  </target>

  <target name="packageStandalone" description="Create Jar for
    standalone Hecl" depends="compileCommandline,compileHttpStandard">
    <jar destfile="StandaloneHecl.jar" basedir="build/core" update="true"/>
    <jar destfile="StandaloneHecl.jar" basedir="build/files" update="true"/>
    <jar destfile="StandaloneHecl.jar" basedir="build/http_standard" update="true"/>
    <jar destfile="StandaloneHecl.jar" basedir="build/commandline" includes="StandaloneHecl.class" update="true">
      <manifest>
        <attribute name="Main-Class" value="StandaloneHecl"/>
      </manifest>
    </jar>
  </target>


  <target name="packageJARs" description="Create Jar distributions of the sources"
    depends="compile,initPackage">
    <jar destfile="out/heclCore.jar" basedir="build/core"/>
    <jar destfile="out/heclApplet.jar" basedir="build/applet"/>
    <jar destfile="out/heclFiles.jar" basedir="build/files"/>
<!--    <jar destfile="out/heclHttp.jar" basedir="build/http"/> -->
  </target>

  <target name="packageApplet" description="Create HTML applet structure"
    depends="initPackage,packageJARs">
    <mkdir dir="out/applet"/>
    <copy file="out/heclCore.jar" tofile="out/applet/heclCore.jar"/>
    <copy file="out/heclApplet.jar" tofile="out/applet/heclApplet.jar"/>
    <copy file="out/heclFiles.jar" tofile="out/applet/heclFiles.jar"/>
<!--     <copy file="out/heclHttp.jar" tofile="out/applet/heclHttp.jar"/> -->
    <copy file="HTML/applet.html" tofile="out/applet/index.html"/>
  </target>

  <!-- J2ME versions -->
  <target name="packageJ2MESource"
    depends="initPackage"
    description="Create source structure for J2ME">
    <mkdir dir="out/j2mesource"/>
    <copy todir="out/j2mesource">
      <fileset dir="core"/>
      <fileset dir="http"/>
      <fileset dir="j2me"/>
    </copy>
  </target>

  <target name="buildJ2MEtest"
    depends="packageJ2MESource"
    description="Builds J2ME Hecl test">
    <mkdir dir="out/j2me"/>
    <javac srcdir="out/j2mesource" destdir="out/j2me" target="1.1">
      <classpath refid="classpath"/>
    </javac>
  </target>

  <target name="packageJ2MEtest"
    depends="buildJ2MEtest"
    description="Packages J2ME Hecl test as a JAR">
    <jar destfile="out/j2me.jar" basedir="out/j2me">
      <manifest>
	<attribute name="MicroEdition-Configuration" value="CLDC-1.0"/>
	<attribute name="MIDlet-Name" value="Heclmidlettest"/>
	<attribute name="MIDlet-Vendor" value="Dedasys"/>
	<attribute name="MIDlet-Permissions" value="javax.microedition.io.Connector.http"/>
	<attribute name="MIDlet-1" value="Heclmidlettest, Heclmidlettest.png, Heclmidlettest"/>
	<attribute name="MIDlet-Version" value="1.2"/>
	<attribute name="MicroEdition-Profile" value="MIDP-1.0"/>
      </manifest>
    </jar>
  </target>

  <!-- Docs -->

  <target name="javadocs">
    <javadoc packagenames="org.hecl"
      sourcepath="core"
      destdir="docs/jdocs"
      author="true"
      version="true"
      use="true">
    </javadoc>
  </target>

  <target name="docbook">
    <exec executable="xsltproc">
      <arg value="--nonet" />
      <arg value="--stringparam" />
      <arg value="html.stylesheet" />
      <arg value="hecl.css" />
      <arg value="-o"/>
      <arg value="docs/" />
      <arg value="docs/chunk.xsl" />
      <arg value="docs/hecl.xml" />
    </exec>
  </target>

  <target name="docs" depends="javadocs,docbook">
  </target>

</project>
