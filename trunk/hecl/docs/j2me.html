<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Hecl and Java ME</title><link rel="stylesheet" href="hecl.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.73.2"><link rel="start" href="index.html" title="Hecl - The Mobile Scripting Language"><link rel="up" href="index.html" title="Hecl - The Mobile Scripting Language"><link rel="prev" href="heclandjava.html" title="Interfacing Hecl and Java"><link rel="next" href="midp10_alert.html" title="alert"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Hecl and Java ME</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="heclandjava.html"><img src="images/prev.png" alt="Prev"></a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="midp10_alert.html"><img src="images/next.png" alt="Next"></a></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="j2me"></a>Hecl and Java ME</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="j2me.html#javame_tutorial">Hecl Java ME Tutorial</a></span></dt><dt><span class="section"><a href="j2me.html#midp10_commands">Hecl J2ME MIDP1.0 Commands</a></span></dt><dt><span class="section"><a href="j2me.html#midp20commands">Hecl Java ME MIDP2.0 Commands</a></span></dt><dt><span class="section"><a href="j2me.html#heclapps">Creating your own Hecl Java ME apps</a></span></dt><dt><span class="section"><a href="j2me.html#example_application">Example application</a></span></dt><dt><span class="section"><a href="j2me.html#hacking_hecl_j2me">Hacking Hecl's Java ME code</a></span></dt></dl></div><p>
      Hecl is designed to be small enough to run on mobile devices
      such as cell phones.  This means that for the Hecl core, has
      been necessary to limit ourselves to Java API's that work with
      J2ME.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="javame_tutorial"></a>Hecl Java ME Tutorial</h3></div></div></div><p>
	This tutorial first appeared here:
	<a class="ulink" href="http://www.freesoftwaremagazine.com/articles/creating_a_simple_application_with_hecl" target="_top">
	  Create a simple application with Hecl - Introducing Hecl, a mobile phone scripting
	  language </a>.  It is a tutorial style introduction writing Hecl code for mobile
	  phones, by David Welton.
      </p><p>
	These days, almost everyone has a cell phone; cell phones keep getting faster, smarter, and
	more capable, yet relatively few applications exist for them. The Hecl programming language
	makes it easy to script applications for your cell phone - with just a few lines of code, you
	can create applications that you can carry with you, everywhere.
      </p><p>
	I first fell in love with computers when my parents bought me a Commodore 64, a fairly nice
	computer for the time. Thanks to Moore's law, and the relentless pace of development, the
	average cell phone is now more powerful than that machine from just 20 some years ago. While
	it's understandable that many people just want to make phone calls, think of all the
	programs out there waiting to be written that take advantage of the fact that you almost
	always have a cell phone with you. I think I'm just beginning to scratch the surface of
	what's possible, especially as phones continue to get faster, and have better connections to
	the internet.
      </p><p>
	I became interested in writing cell phone applications several years ago, after a rainy day
	high in the Italian Dolomites near Cortina d'Ampezzo - my old phone ended up in a mud puddle
	and died, leading me to purchase a new phone with J2ME (Java) capabilities. Writing
	applications in Java was okay, but I thought to myself that it would be an interesting
	experiment to try and create a scripting language that runs on top of the J2ME (now known as
	Java Micro Edition or Java ME) environment.
      </p><p>When I created Hecl, I did so with several goals in mind:</p><div class="orderedlist"><ol type="1"><li><p>
	    Make it even easier and faster for experienced programmers to create cell phone applications.
	  </p></li><li><p>
	    Make it possible for novice programmers to create cell phone applications without the
	    burden of dealing with Java.
	  </p></li></ol></div><p>
	Hecl has other benefits too - it's faster to develop applications, because you don't have to
	recompile after each change. In the hands of a clever programmer, it's also possible to do
	interesting things with Hecl because of its interpreted nature. You could start an
	application on your phone, and download additional bits of code off the web.
      </p><p>
	The aim of this tutorial is to help you create cell phone applications, so let's get started
	right away. You'll need a few things first:
      </p><div class="itemizedlist"><ul type="disc"><li><p>
	    Sun's Java. This is heading towards free software, but isn't quit there yet. If you run
	    Ubuntu, like me, you can get Java with apt: <strong class="userinput"><code>apt-get install
	    sun-java5-jdk</code></strong>, if you've added the "multiverse" repositories to your
	    <code class="filename">/etc/apt/sources.list</code> file: <code class="code">deb
	    http://us.archive.ubuntu.com/ubuntu/ feisty multiverse</code>
	  </p></li><li><p>
	    <a class="ulink" href="http://java.sun.com/products/sjwtoolkit/download-2_5_1.html" target="_top">Sun's WTK
	    toolkit</a>. While you don't need the tools to compile Hecl (unless you want to hack
	    on it!), you do want the emulator, so that you don't have to load your app onto your
	    phone each time you want to test it. It's not open source software (yet?), but it does
	    run on Linux, Mac and Windows, and of course it is free.
	  </p></li><li><p>
	    Hecl itself. You can get it from the Sourceforge <a class="ulink" href="http://sourceforge.net/project/showfiles.php?group_id=122383" target="_top">download
	      page</a>.
	    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
		Hecl is always improving, so you should also consider checking out Hecl directly
		from subversion: <strong class="userinput"><code>svn co
		https://hecl.svn.sourceforge.net/svnroot/hecl/trunk/hecl hecl</code></strong>
	      </p></td></tr></table></div><p>
	  </p></li></ul></div><p>
	Sun's WTK requires installation - you can put it somewhere like <code class="filename">/opt</code>,
	so it won't get mixed up with the rest of your system. The installation process is very
	simple - just say yes to a few questions, and you're done. Hecl doesn't require
	installation: everything you need is already there in the distribution.
      </p><p>
	To see if everything's working, you can try launching the emulator with the sample
	application: <strong class="userinput"><code>/opt/WTK2.5.2/bin/emulator -classpath
	jars/cldc1.1-midp2.0/Hecl.jar Hecl</code></strong>
      </p><p>That should bring up something like this:</p><div class="screenshot"><div><img src="demo_screenshot.png"></div></div><p>
	This is Hecl's built in demo - its source code is located in
	<code class="filename">midp20/script.hcl</code>, but before I get too far ahead of myself, let's go
	back and create the classic "Hello World" application, just to get started and see how to
	work with Hecl.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
	  Hecl actually comes in several flavors, with slightly different GUI commands - MIDP1.0
	  (older phones), which has fewer commands and doesn't do as much, and MIDP2.0, for newer
	  phones, which has a lot more features. This tutorial utilizes the MIDP2.0 commands,
	  because that's what current phones are based on. The concepts described are very similar
	  for the MIDP1.0 commands, but the commands are slightly different. Please contact us if
	  you are interested in a MIDP1.0 version of this tutorial.
	</p></td></tr></table></div><p>
	To write your first Hecl program, open a text editor, and type the following program into a
	file - I'll call it <code class="filename">hello.hcl</code>:
      </p><pre class="programlisting">
proc HelloEvents {cmd form} {
    [lcdui.alert -text "Hellllllllooooo, world!" -timeout forever] setcurrent
}

set form [lcdui.form -title "Hello world" -commandaction HelloEvents]
set cmd [lcdui.command -label "Hello" -longlabel "Hello Command" -type screen]

$form setcurrent
$form addcommand $cmd

$form append [lcdui.stringitem -label "Hello" -text "World"]
</pre><p>
	Not bad - 8 lines of code, and most of it's pretty clear just from looking at it. I'll go
	through it line by line, so you understand exactly what's happening.
      </p><div class="orderedlist"><ol type="1"><li><p>
	    The first bit of code, that starts with <code class="code">proc HelloEvents</code>, defines a
	    "procedure": in other words a function called <span class="command"><strong>HelloEvents</strong></span>. When this
	    function is called, it creates an "alert" - think of it as a pop up message telling you
	    something important. <code class="option">-timeout forever</code> tells the message to stay on the
	    screen until the user dismisses it.
	  </p></li><li><p>
	    The second command defines a form, with the command <span class="command"><strong>lcdui.form</strong></span>, with
	    the title of "Hello World", and connected to the <span class="command"><strong>HelloEvents</strong></span>
	    proc. What this connection means is that when any commands associated with the form are
	    activated by the user, this procedure is called to handle them. The code <code class="code">set
	    form</code> stores the form object in the variable <code class="varname">form</code>, so that it
	    can be referenced later.
	  </p></li><li><p>
	    The following line creates a command that can be activated by the user. It has the label
	    "Hello", and is stored in the variable <code class="varname">cmd</code>. I use the
	    <code class="constant">screen</code> type for the command, which is used for user defined
	    commands. There are some other predefined types such as <code class="constant">exit</code> and
	    <code class="constant">back</code>.
	  </p></li><li><p>
	    <code class="code">$form setcurrent</code> references the previously created form, and tells Hecl to
	    display it on the screen.
	  </p></li><li><p>
	    The <span class="command"><strong>addcommand</strong></span> subcommand (you could also think of it as a "method",
	    like in an object oriented language) attaches the command I created above to the
	    form. This makes the command visible in the form.
	  </p></li><li><p>
	    Finally, I display a string on the form with the <span class="command"><strong>lcdui.stringitem</strong></span>
	    command. On most phones, the <code class="option">-label</code> text is displayed in bold, and the
	    <code class="option">-text</code> text is displayed next to it.
	  </p></li></ol></div><p>
	That's it! Now, to transform the code into a cell phone application, run a command:
      </p><pre class="programlisting">
java -jar jars/JarHack.jar jars/cldc1.1-midp2.0/Hecl.jar ~/ Hello hello.hcl
</pre><p>
	This is all it takes - this command takes the existing <code class="filename">Hecl.jar</code> file,
	and replaces the Hecl script within with our newly created <code class="filename">hello.hcl</code>
	script, and creates the resulting <code class="filename">Hello.jar</code> in your home directory
	(referenced as <code class="filename">~/</code> in the command above).
      </p><p>
	Now, we can run the code in the emulator to see the application (figure 2).
      </p><div class="screenshot"><div><img src="hello_screenshot1.png"></div></div><p>
	Highlighted, from the top, are the form's <code class="option">-title</code>, the
	<span class="command"><strong>stringitem</strong></span>, and in the lower right corner, the command labeled Hello.
      </p><p>
	If you press the "hello" button, the code in <span class="command"><strong>HelloEvents</strong></span> is executed, and
	an "alert" is popped up onto the screen, and stays there until you hit the "Done"
	button.
      </p><p>
	While creating an application is very easy, unfortunately, installing it on a phone is not;
	there isn't much that Hecl can do to ease that process, which is different for each
	phone. On Linux, for my Nokia telephone, I use the gammu program to transfer programs to my
	phone, like so:
      </p><p><strong class="userinput"><code>gammu nothing --nokiaaddfile Application Hecl</code></strong></p><p>
	Another method that may work better across different phones is to use the phone's browser to
	download and install the application, by placing the <code class="filename">.jar</code> and
	<code class="filename">.jad</code> files on a publicly accessible web server, and accessing the
	<code class="filename">.jad</code> file.
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Note that this will likely cost money in connection charges!</p></td></tr></table></div><p>
      </p><p>
	So far so good. Next, I'll create a small application that you can interact with to do
	something useful. It's a simplified version of the shopping list that can be found <a class="ulink" href="http://shoplist.dedasys.com" target="_top">here</a>. The theory of operation behind this
	application is simple: typing a shopping list into a mobile phone is pretty painful - it's
	much better to do the data entry via a web page, and then fetch the list with the mobile
	phone application.
      </p><p>
	For this tutorial, I've created a simple list on the ShopList web site, with the PIN number
	<code class="constant">346764</code>, which can be viewed <a class="ulink" href="" target="_top">here</a>. Feel free to create your
	own shopping lists - the site costs nothing to use. The cell phone application works like
	so: by entering the PIN, it downloads the list of items and displays them on the phone
	screen as a series of checkboxes. Have a look at the code to do this:
      </p><pre class="programlisting">
# Process events associated with the shopping list screen.
proc ShopListEvents {exitcmd backcmd cmd shoplist} {
    if { eq $cmd $exitcmd } {
	midlet.exit
    } elseif { eq $cmd $backcmd } {
	global shopform
	$shopform setcurrent
    }
}

# Create a new shopping list screen and fetch .
proc MakeList {exitcmd backcmd pin} {
    set url "http://shoplist.dedasys.com/list/fetch/${pin}"
    # Fetch the data, and retrieve the data field from the results hash.
    set data [hget [http.geturl $url] data]
    if { eq $data "PIN NOT FOUND" } {
	[lcdui.alert -type warning \
	     -title "Pin Not Found" \
	     -timeout forever\
	     -text "The PIN $pin was not found on shoplist.dedasys.com"] setcurrent
	return
    }
    set shoplist [lcdui.list -title "Shopping List" \
		      -type multiple]
    foreach e [split $data \n] {
	$shoplist append $e
    }
    $shoplist addcommand $exitcmd
    $shoplist addcommand $backcmd
    $shoplist setcurrent
    $shoplist configure -commandaction \
	[list ShopListEvents $exitcmd $backcmd]
}

# Process events associated with the main form.
proc ShopFormEvents {backcmd exitcmd pinfield
		     fetchcmd cmd shopform} {
    if { eq $cmd $exitcmd } {
	midlet.exit
    } elseif { eq $fetchcmd $cmd } {
	MakeList $exitcmd $backcmd \
	    [$pinfield cget -text]
    }
}

# The action starts here...

# Create a generic back command.
set backcmd [lcdui.command \
		 -label Back \
		 -longlabel Back -type back -priority 1]
# Create an exit command.
set exitcmd [lcdui.command \
		 -label Exit \
		 -longlabel Exit -type exit -priority 2]

# Create the form.
set shopform [lcdui.form -title "Shopping List"]
set pinfield [lcdui.textfield \
		  -label "shoplist.dedasys.com PIN:" \
	          -type numeric]
set fetchcmd [lcdui.command -label "Fetch" \
		  -longlabel "Fetch Shopping List" \
		  -type screen -priority 1]

$shopform append $pinfield
$shopform addcommand $exitcmd
$shopform addcommand $fetchcmd
$shopform setcurrent

$shopform configure -commandaction \
    [list ShopFormEvents $backcmd $exitcmd $pinfield $fetchcmd]
</pre><p>
	This is certainly more complex than the first example, but the general pattern is the same -
	screen widgets and items are created, displayed, and procs are called to deal with
	commands.
      </p><p>
	As I mentioned previously, commands with specific, predefined tasks have their own types, as
	I can see with the <span class="command"><strong>back</strong></span> and <span class="command"><strong>exit</strong></span> commands, which are respectively
	of types "back" and "exit".
      </p><p>
	After the two commands are defined, I create a form and add a textfield to it. By specifying
	<code class="option">-type numeric</code> for the textfield, I indicate that it is only to accept
	numbers - no letters or symbols.
      </p><p>
	After creating the Fetch command, I append the textfield to the form (or else it wouldn't be
	visible), add the two commands to the form, and then, with <span class="command"><strong>setcurrent</strong></span>,
	make the form visible. The last line of code configures the form to utilize the
	<span class="command"><strong>ShopFormEvents</strong></span> proc to handle events. The list argument warrants further
	explanation:
      </p><p>
	Hecl, like many programming languages, has a <span class="command"><strong>global</strong></span> command that could be
	used in the various procs that utilize the <span class="command"><strong>back</strong></span> and
	<span class="command"><strong>exit</strong></span> commands - you could simply say <code class="code">global backcmd</code>, and
	then the <code class="varname">$backcmd</code> variable would be available in that procedure. However,
	using global variables all over the place gets kind of messy, so what I want to do is pass
	in everything that the proc might need, and I do so by creating a list: <code class="code">ShopFormEvents
	$backcmd $exitcmd $pinfield $fetchcmd</code>. You can see that these corresponds to the
	arguments that the proc takes: <code class="code">proc ShopFormEvents {backcmd exitcmd pinfield fetchcmd
	cmd shopform}</code>, except for the last two, which Hecl
	<span class="emphasis"><em>automatically</em></span> passes in. <code class="varname">cmd</code> is the command that was
	actually called, and <code class="varname">shopform</code> is of course the form that the proc was
	called with. By comparing <code class="varname">$cmd</code> with the various commands that are
	available, it's possible to determine which command called the proc, and act accordingly.
      </p><p>Now, let's build it and run it:</p><pre class="programlisting">
java -jar jars/JarHack.jar jars/cldc1.1-midp2.0/Hecl.jar ~/ ShopList shoplist.hcl
/opt/WTK2.5.2/bin/emulator -classpath ShopList.jar Hecl
</pre><div class="screenshot"><div><img src="shoplist1.png"></div></div><p>
	At this point, you enter the PIN number (<code class="constant">346764</code>), and press the Fetch
	button. This command executes the code in <span class="command"><strong>MakeList</strong></span>. The first thing it
	does is attempt to fetch the data from the shoplist site, using the
	<span class="command"><strong>http.geturl</strong></span> command. Since this command returns a hash table, in order to
	get at the data returned, I use the <span class="command"><strong>hget</strong></span> command to access the "data"
	element. If the PIN was not available on the server, an error message is returned, and the
	user is returned to the first screen. Otherwise, a list of checkboxes is created with
	<span class="command"><strong>lcdui.list</strong></span>, by specifying "multiple" as the type. Since the shopping list
	is sent "over the wire" (so to speak...) as a list of lines, all I have to do to add it to
	the display is split it by lines with the <span class="command"><strong>split</strong></span> command, and then iterate
	over that list with <span class="command"><strong>foreach</strong></span>. The result looks like that displayed figure
	4.
      </p><div class="screenshot"><div><img src="shoplist2.png"></div></div><p>
	And there you have it, a network-based shopping list in less than 100 lines of code. Of
	course, there is room for improvement. For instance, in the production version of this
	shopping list application, RecordStore (in Hecl, the <span class="command"><strong>rms.*</strong></span> commands make
	this functionality available) is utilized to save the list and its state between invocations
	of the program, so that you can leave the application, run it again, and find the list as
	you left it. Support for multiple lists might also be handy.
      </p><p>
	Of course, this tutorial barely scratches the surface. Hecl has a number of other GUI
	commands, and is a complete programming language that can do some interesting and dynamic
	things. If you're curious, the best way to learn more is to keep reading the documentation,
	and sign up for the <a class="ulink" href="http://lists.sourceforge.net/lists/listinfo/hecl-devel" target="_top">Hecl
	mailing list</a> on SourceForge.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="midp10_commands"></a>Hecl J2ME MIDP1.0 Commands</h3></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="midp10_alert.html">alert</a></span><span class="refpurpose"> &#8212; Creates an alert</span></dt><dt><span class="refentrytitle"><a href="midp10_choicegroup.html">choicegroup</a></span><span class="refpurpose"> &#8212; Displays a choicegroup in the current form</span></dt><dt><span class="refentrytitle"><a href="midp10_cmd.html">cmd</a></span><span class="refpurpose"> &#8212; Adds a command to a form/listbox/textbox</span></dt><dt><span class="refentrytitle"><a href="midp10_datefield.html">datefield</a></span><span class="refpurpose"> &#8212; Displays an datefield in the current form</span></dt><dt><span class="refentrytitle"><a href="midp10_j2me_exit.html">exit</a></span><span class="refpurpose"> &#8212; Exits the application</span></dt><dt><span class="refentrytitle"><a href="midp10_form.html">form</a></span><span class="refpurpose"> &#8212; Creates a form</span></dt><dt><span class="refentrytitle"><a href="midp10_gauge.html">gauge</a></span><span class="refpurpose"> &#8212; Displays an gauge in the current form</span></dt><dt><span class="refentrytitle"><a href="midp10_getindex.html">getindex</a></span><span class="refpurpose"> &#8212; Fetches a reference to the N'th element in a
	  given form/listbox</span></dt><dt><span class="refentrytitle"><a href="midp10_getprop.html">getprop</a></span><span class="refpurpose"> &#8212; Fetches the value of a given property from a widget</span></dt><dt><span class="refentrytitle"><a href="midp10_listbox.html">listbox</a></span><span class="refpurpose"> &#8212; Creates a listbox</span></dt><dt><span class="refentrytitle"><a href="midp10_noscreen.html">noscreen</a></span><span class="refpurpose"> &#8212; Runs without a current screen widget</span></dt><dt><span class="refentrytitle"><a href="midp10_screenappend.html">screenappend</a></span><span class="refpurpose"> &#8212; Appends an item to a form or listbox</span></dt><dt><span class="refentrytitle"><a href="midp10_setcurrent.html">setcurrent</a></span><span class="refpurpose"> &#8212; Displays an alert/form/listbox/textbox</span></dt><dt><span class="refentrytitle"><a href="midp10_setindex.html">setindex</a></span><span class="refpurpose"> &#8212; 
	    Sets the
	    <code class="option"><em class="replaceable"><code>index</code></em></code>th
	    element in a form/listbox to specified item</span></dt><dt><span class="refentrytitle"><a href="midp10_setprop.html">setprop</a></span><span class="refpurpose"> &#8212; Sets a given property of a widget</span></dt><dt><span class="refentrytitle"><a href="midp10_string.html">string</a></span><span class="refpurpose"> &#8212; Adds a string to the current form.</span></dt><dt><span class="refentrytitle"><a href="midp10_stringitem.html">stringitem</a></span><span class="refpurpose"> &#8212; Displays a stringitem in the current form</span></dt><dt><span class="refentrytitle"><a href="midp10_textbox.html">textbox</a></span><span class="refpurpose"> &#8212; Creates a textbox</span></dt><dt><span class="refentrytitle"><a href="midp10_textfield.html">textfield</a></span><span class="refpurpose"> &#8212; Displays a textfield in the current form</span></dt></dl></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
	Hecl has different GUI commands for the MIDP1.0 (older phones)
	and MIDP2.0 (newer).  We are in the process of documenting the
	MIDP2.0 commands.
      </td></tr></table></div><p>
	Commands available in the J2ME MIDP1.0 version of Hecl to
	interact with the phone.  Look in the
	<code class="filename">midp10/examples</code> directory for examples of
	these commands and widgets in use.
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="midp20commands"></a>Hecl Java ME MIDP2.0 Commands</h3></div></div></div><div class="toc"><dl><dt><span class="refentrytitle"><a href="lcdui_alert.html">lcdui.alert</a></span><span class="refpurpose"> &#8212; Pops up an alert</span></dt><dt><span class="refentrytitle"><a href="lcdui_canvas.html">lcdui.canvas</a></span><span class="refpurpose"> &#8212; Creates a canvas</span></dt><dt><span class="refentrytitle"><a href="lcdui_choicegroup.html">lcdui.choicegroup</a></span><span class="refpurpose"> &#8212; Creates a group of potential choices that can be
	  added to a form.</span></dt><dt><span class="refentrytitle"><a href="lcdui_command.html">lcdui.command</a></span><span class="refpurpose"> &#8212; Creates a command that can be attached to a screen</span></dt><dt><span class="refentrytitle"><a href="lcdui_date.html">lcdui.date</a></span><span class="refpurpose"> &#8212; Date/Time widget for lcdui forms</span></dt><dt><span class="refentrytitle"><a href="lcdui_event.html"><em class="replaceable"><code>$eventcmd</code></em></a></span><span class="refpurpose"> &#8212; Command/object describing a Canvas event.</span></dt><dt><span class="refentrytitle"><a href="lcdui_font.html">lcdui.font</a></span><span class="refpurpose"> &#8212; Font information and manipulation command.</span></dt><dt><span class="refentrytitle"><a href="lcdui_form.html">lcdui.form</a></span><span class="refpurpose"> &#8212; Creates a form that can contain various widgets</span></dt><dt><span class="refentrytitle"><a href="lcdui_gauge.html">lcdui.gauge</a></span><span class="refpurpose"> &#8212; Creates a gauge widget that can be attached to a
	  form.</span></dt><dt><span class="refentrytitle"><a href="lcdui_image.html">lcdui.image</a></span><span class="refpurpose"> &#8212; Creates an image.</span></dt><dt><span class="refentrytitle"><a href="lcdui_imageitem.html">lcdui.imageitem</a></span><span class="refpurpose"> &#8212; An item that can contain an image, in order to attach it to a form.</span></dt><dt><span class="refentrytitle"><a href="lcdui_list.html">lcdui.list</a></span><span class="refpurpose"> &#8212; Creates a full-screen list</span></dt><dt><span class="refentrytitle"><a href="lcdui_settings.html">lcdui.settings</a></span><span class="refpurpose"> &#8212; Returns or sets information about the graphical environment.</span></dt><dt><span class="refentrytitle"><a href="lcdui_spacer.html">lcdui.spacer</a></span><span class="refpurpose"> &#8212; Creates a spacer element in a form.</span></dt><dt><span class="refentrytitle"><a href="lcdui_stringitem.html">lcdui.stringitem</a></span><span class="refpurpose"> &#8212; Creates a string item that can be added to a form.</span></dt><dt><span class="refentrytitle"><a href="lcdui_textbox.html">lcdui.textbox</a></span><span class="refpurpose"> &#8212; Creates a text box for editing larger blocks of text.</span></dt><dt><span class="refentrytitle"><a href="lcdui_textfield.html">lcdui.textfield</a></span><span class="refpurpose"> &#8212; Creates a small text editing widget that can be attached to a
	  form.</span></dt><dt><span class="refentrytitle"><a href="lcdui_ticker.html">lcdui.ticker</a></span><span class="refpurpose"> &#8212; Creates a ticker that scrolls horizontally.</span></dt></dl></div><p>
	The MIDP 2.0 commands in Hecl are more complete and more
	advanced than the 1.0 commands, and should be used if
	possible.  This is a fairly complete list of which devices are
	MIDP2.0 capable: <a class="ulink" href="http://www.j2mepolish.org/devices/platform_MIDP_2.0.html" target="_top">http://www.j2mepolish.org/devices/platform_MIDP_2.0.html</a>
      </p><p>
	To fully understand these commands, a perusal of the
	documentation here is likely a good idea: <a class="ulink" href="http://java.sun.com/javame/reference/apis/jsr118/" target="_top">http://java.sun.com/javame/reference/apis/jsr118/</a>
	In particular, look at the lcdui package.
      </p><p>
	This code was originally written and contributed to Hecl by
	Wolfgang Kechel.  Thanks!
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="heclapps"></a>Creating your own Hecl Java ME apps</h3></div></div></div><p>
	Creating new hecl applications is relatively easy using the
	<span class="application">HeclBuilder</span> application.
      </p><div class="procedure"><ol type="1"><li><p>
	    Launch it like so:
	  </p><pre class="screen">java -jar jars/HeclBuilder.jar</pre><p>
	    It should look something like this:
	  </p><div class="screenshot"><div class="mediaobject"><img src="heclbuilder-screen.png"><div class="caption">
		HeclBuilder in action
	      </div></div></div></li><li><p>
	    First, you must select a script to use for your Hecl
	    application.  We recommend that you create this yourself
	    using your favorite editor (if it has a Tcl mode, that
	    will make things even easier).  The provided editor is not
	    yet really worthy of the name!
	  </p></li><li><p>
	    The next field (<span class="guilabel">MIDlet name</span>) is the
	    name of your Hecl application.  This will be used both as
	    the name visible on the cell phone, as well as the name of
	    the .jar file.
	  </p></li><li><p>
	    Select a directory where the resulting .jar and .jad files
	    will be placed.
	  </p></li><li><p>
	    At this point, all you have to do is press the "Go"
	    button, and the .jar and .jad files will be created for
	    you.  All that's left is to move them on to the cell
	    phone, but we can't do that for you, as there is no
	    standard method - each phone manufacturer provides their
	    own way.  On Linux, I use the following command:
	  </p><pre class="screen">gammu nothing --nokiaaddfile Application Hecl</pre></li><li><p>
	    If you have some sort of J2ME SDK that includes an
	    emulator, now would be a good time to try out your
	    application before running it on your phone.  You can get
	    that is free (if not open source) from Sun here: <a class="ulink" href="http://java.sun.com/products/sjwtoolkit/" target="_top">http://java.sun.com/products/sjwtoolkit/</a>
	    .  I run it like this:
	  </p><pre class="screen">/opt/WTK2.5.2/bin/emulator -classpath MyApp.jar Hecl</pre><p>
	    Note that <code class="option">Hecl</code> above will not change,
	    because that is always the main class, even if the
	    application itself has a different name.
	  </p></li></ol></div><p>
	This leads to a very quick development cycle - if you leave
	HeclBuilder open, all you have to do to update your .jar and
	.jad files after you have edited your Hecl script, is to click
	the <span class="guibutton">Create .jar/.jad files</span> button!
      </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="example_application"></a>Example application</h3></div></div></div><p>
	For example, let's create a simple form with a text entry
	widget and a command that acts on it:
      </p><pre class="programlisting">proc reverse {tf results} {
    set string [getprop $tf text]
    set newstring ""
    set i [slen $string]
    incr $i -1
    while {&gt; $i -1} {
	set c [sindex $string $i]
	append $newstring $c
	incr $i -1
    }
    setprop $results text $newstring
}

set mainform [form label "Reverse a String" code {
    set tf [textfield label "String:"]
    set results [stringitem label "Results:"]
    cmd label "Reverse" code [list reverse $tf $results]
    cmd label "Exit" code exit type exit;
}]

setcurrent $mainform
</pre><p>
	This program is pretty simple.  It displays a form, which
	contains a textfield and a stringitem, and two commands,
	<span class="command"><strong>Reverse</strong></span> and <span class="command"><strong>Exit</strong></span>.  When
	you select <span class="command"><strong>Reverse</strong></span>, the text contained in
	the textfield is reversed, and displayed in the stringitem.
	Exit does what you might expect.
      </p><p>
	The code is fairly self-explanatory, with a few key points
	worth noting.  Within the <span class="command"><strong>reverse</strong></span> proc,
	<span class="command"><strong>getprop</strong></span> and <span class="command"><strong>setprop</strong></span> are
	used to fetch and set properties of the textfield and
	stringitem.  All the GUI elements have fairly similar
	arguments, for instance <code class="option">label</code> for the label,
	and <code class="option">code</code> for the code associated with them.
	Note thouth that the code associated with the form is
	evaluated immediately, whereas that associated with the
	commands is only evaluated when they are selected.  Lastly, to
	actually display this on the screen, it's necessary to set the
	form as the screen item currently displayed.
      </p><p>The program looks more or less like this when run:

      </p><div class="screenshot"><div class="mediaobject"><img src="reverse-screen.png"><div class="caption">
	    "reverse" screenshot, with textfield, stringitem, and two
	    commands, Reverse and Exit
	  </div></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="hacking_hecl_j2me"></a>Hacking Hecl's Java ME code</h3></div></div></div><p>
	Since Java ME comes in several flavors that Hecl can be compiled for, it's necessary to
	understand what Hecl does, and how it does it.
      </p><p>
	JavaME has two layers that are of interest to us, "CLDC" and "MIDP".  CLDC is available in
	1.0 and 1.1 configurations, whereas MIDP comes in 1.0 and 2.0 configurations.  The most
	common configurations are CLDC 1.0 and MIDP 1.0, CLDC 1.0 and MIDP 2.0, and CLDC 1.1 with
	MIDP 2.0.  Here are the Wikipedia entries describing <a class="ulink" href="http://en.wikipedia.org/wiki/Connected_Limited_Device_Configuration" target="_top">CLDC</a> and
	<a class="ulink" href="http://en.wikipedia.org/wiki/MIDP" target="_top">MIDP</a>.
      </p><p>
	Hecl tries to match code to system resources: in other words, the code in the
	<code class="filename">midp10/</code> and <code class="filename">midp10gui</code> (MIDP 1.0) directories is
	smaller, simpler, and has fewer features than the code in <code class="filename">midp20</code> and
	<code class="filename">midp20gui</code> (MIDP 2.0), reflecting the fact that many 1.0 devices only
	allow very small jar files ("midlets").
      </p><p>
	For MIDP 1.0, the <code class="filename">midp10gui</code> directory contains the
	<code class="filename">GUICmds.java</code>, which has most of the functionality that maps J2ME
	functionality to Hecl and back.  The <code class="filename">midp10/Hecl.java</code> file contains the
	code that starts up Hecl on the cell phone.  For MIDP 2.0, the
	<code class="filename">midp20gui</code> directory contains the GUI commands, and
	<code class="filename">midp20/Hecl.java</code> is where the application is launched from on the
	phone.
      </p><p>
	In order to be able to deal with all these different versions, Hecl is more or less forced
	to utilize a Java preprocessor, which explains all the ifdef's in the code.  The various
	symbols are defined in the <code class="filename">settings.xml</code> file.
      </p><p>
	To compile different combinations of things, Hecl makes a couple of property files
	available that are used like so:
      </p><pre class="screen">
 ant -propertyfile ./cldc10midp10.properties midlet
      </pre><p>
	Which compiles the CLDC 1.0 / MIDP 1.0 version of Hecl and places the jar in the
      <code class="filename">jars/cldc1.0-midp1.0/</code> directory, or:
      </p><pre class="screen">
 ant -propertyfile ./cldc11midp20.properties midlet
      </pre><p>Which compiles the CLDC 1.1 / MIDP 2.0 version, and places the jar in the
      <code class="filename">jars/cldc1.1-midp2.0/</code> directory.</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="heclandjava.html"><img src="images/prev.png" alt="Prev"></a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="midp10_alert.html"><img src="images/next.png" alt="Next"></a></td></tr><tr><td width="40%" align="left" valign="top">Interfacing Hecl and Java </td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.png" alt="Home"></a></td><td width="40%" align="right" valign="top"> alert</td></tr></table></div></body></html>
