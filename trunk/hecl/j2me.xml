<project name="j2me" basedir=".">
  <!-- J2ME build targets -->

  <target name="j2meLibs10" description="Compile the basics for cldc 1.0">
    <antcall target="j2meLibs" inheritAll="false">
      <param name="wtk.cldc.version" value="1.0"/>
      <param name="wtk.midp.version" value="1.0"/>
    </antcall>

    <antcall target="j2meLibs" inheritAll="false">
      <param name="wtk.cldc.version" value="1.0"/>
      <param name="wtk.midp.version" value="2.0"/>
    </antcall>
  </target>

  <target name="j2meLibs11" description="Compile the basics for cldc 1.1">
    <antcall target="j2meLibs" inheritAll="false">
      <param name="wtk.cldc.version" value="1.1"/>
      <param name="wtk.midp.version" value="2.0"/>
    </antcall>
  </target>

  <target name="main10" description="Compile main app for MIDP1.0">
    <antcall target="midp10" inheritAll="false">
      <param name="wtk.cldc.version" value="1.0"/>
      <param name="wtk.midp.version" value="1.0"/>
    </antcall>
  </target>

  <target name="main20" description="Compile main app for MIDP2.0">
<!--     <antcall target="midp20" inheritAll="false"> -->
<!--       <param name="wtk.cldc.version" value="1.0"/> -->
<!--       <param name="wtk.midp.version" value="2.0"/> -->
<!--     </antcall> -->

    <antcall target="midp20" inheritAll="false">
      <param name="wtk.cldc.version" value="1.1"/>
      <param name="wtk.midp.version" value="2.0"/>
    </antcall>
  </target>


  <target name="gui10" description="Compile guis for MIDP1.0">
    <antcall target="midp10gui" inheritAll="false">
      <param name="wtk.cldc.version" value="1.0"/>
      <param name="wtk.midp.version" value="1.0"/>
    </antcall>
  </target>

  <target name="gui20" description="Compile guis for MIDP2.0">
<!--     <antcall target="midp20gui" inheritAll="false"> -->
<!--       <param name="wtk.cldc.version" value="1.0"/> -->
<!--       <param name="wtk.midp.version" value="2.0"/> -->
<!--     </antcall> -->

    <antcall target="midp20gui" inheritAll="false">
      <param name="wtk.cldc.version" value="1.1"/>
      <param name="wtk.midp.version" value="2.0"/>
    </antcall>
  </target>

  <target name="midlets10" description="Compile Midlets for MIDP1.0" depends="j2meLibs10,gui10,main10">
    <antcall target="midlet" inheritAll="false">
      <param name="wtk.cldc.version" value="1.0"/>
      <param name="wtk.midp.version" value="1.0"/>
    </antcall>
  </target>

  <target name="midlets20" description="Compile Midlets for MIDP2.0" depends="j2meLibs10,j2meLibs11,gui20,main20">
<!--     <antcall target="midlet" inheritAll="false"> -->
<!--       <param name="wtk.cldc.version" value="1.0"/> -->
<!--       <param name="wtk.midp.version" value="2.0"/> -->
<!--     </antcall> -->

    <antcall target="midlet" inheritAll="false">
      <param name="wtk.cldc.version" value="1.1"/>
      <param name="wtk.midp.version" value="2.0"/>
    </antcall>
  </target>

  <target name="midp10"
    description="Compile MIDP1.0 code"
    depends="j2meLibs10">

    <mkdir dir="${j2me.build}/stand"/>
    <mkdir dir="${j2me.pre}/stand"/>

    <wtkpreprocess srcdir="midp10" destdir="${j2me.pre}/stand"
      symbols="ant:j2me,ant:${cldc},${j2me.defines}"/>

    <wtkbuild srcdir="${j2me.pre}/stand" target="1.1" source="1.2"
      destdir="${j2me.build}" debug="${hecldebug}">
      <classpath refid="j2me.coreclasspath"/>
      <classpath refid="j2me.httpclasspath"/>
      <classpath refid="j2me.rmsclasspath"/>
    </wtkbuild>
  </target>

  <target name="midp20"
    description="Compile MIDP2.0 code"
    depends="j2meLibs10,j2meLibs11">

    <mkdir dir="${j2me.guiclasspath}"/>
    <mkdir dir="${j2me.pre}/midp20"/>

    <copy file="midp20/hecl_logo.png" todir="${j2me.build}" overwrite="true"/>

    <wtkpreprocess srcdir="midp20" destdir="${j2me.pre}/midp20"
      symbols="ant:j2me,ant:cldc1.1"/>
    <wtkbuild srcdir="${j2me.pre}/midp20" target="1.1" source="1.2"
      cldc="false"
      destdir="${j2me.guiclasspath}">
      <classpath refid="j2me.coreclasspath"/>
    </wtkbuild>
  </target>

  <target name="midlet10" description="Build MIDlet for CLDC-1.0">
    <antcall target="midlet" inheritAll="false">
      <param name="wtk.midp.version" value="1.0"/>
      <param name="wtk.cldc.version" value="1.0"/>
    </antcall>

    <antcall target="midlet" inheritAll="false">
      <param name="wtk.midp.version" value="2.0"/>
      <param name="wtk.cldc.version" value="1.0"/>
    </antcall>
  </target>

  <target name="midlet11" description="Build MIDlet for CLDC-1.1">
    <antcall target="midlet" inheritAll="false">
      <param name="wtk.midp.version" value="2.0"/>
      <param name="wtk.cldc.version" value="1.1"/>
    </antcall>
  </target>

  <target name="compileJ2MECore"
    description="Compile the core classes for J2ME"
    depends="initCompile">

    <mkdir dir="${j2me.build}"/>
    <mkdir dir="${j2me.coreclasspath}" />
    <mkdir dir="${j2me.pre}/core"/>
    <wtkpreprocess srcdir="core"
      symbols="ant:j2me,ant:${cldc}"
      destdir="${j2me.pre}/core"
      verbose="true" />

    <wtkbuild srcdir="${j2me.pre}/core" target="1.1" source="1.2"
      verbose="true" debug="${hecldebug}"
      cldc="false"
      destdir="${j2me.coreclasspath}">
      <classpath refid="j2me.coreclasspath"/>
    </wtkbuild>
  </target>

  <target name="compileJ2MErms" description="Compile Hecl RecordStore"
    depends="initCompile,compileJ2MECore">
    <mkdir dir="${j2me.rmsclasspath}"/>
    <mkdir dir="${j2me.pre}/rms"/>
    <wtkpreprocess srcdir="rms" destdir="${j2me.pre}/rms"
      symbols="ant:j2me,ant:${cldc}"/>
    <wtkbuild srcdir="${j2me.pre}/rms"  target="1.1" source="1.2"
      destdir="${j2me.rmsclasspath}">
      <classpath refid="j2me.coreclasspath"/>
    </wtkbuild>
  </target>

  <target name="compileJ2MEHttp"
    depends="initCompile,compileJ2MECore,compileJ2MErms"
    description="Compile J2ME Hecl http support">
    <mkdir dir="${j2me.httpclasspath}"/>
    <!--<mkdir dir="${j2me.pre}/http"/>
    <wtkpreprocess srcdir="http_micro" destdir="${j2me.pre}/http"
      symbols="ant:j2me,ant:${cldc}">
    </wtkpreprocess>
    <wtkpreprocess srcdir="http" destdir="${j2me.pre}/http"
      symbols="ant:j2me,ant:${cldc}">
    </wtkpreprocess>
    <wtkbuild srcdir="${j2me.pre}/http" target="1.1" source="1.2"
      destdir="${j2me.httpclasspath}">
      <classpath refid="j2me.coreclasspath"/>
    </wtkbuild>
    -->
    <mkdir dir="${j2me.pre}/net"/>
    <wtkpreprocess srcdir="net" destdir="${j2me.pre}/net"
      symbols="ant:j2me,ant:${cldc}">
    </wtkpreprocess>
    <wtkbuild srcdir="${j2me.pre}/net" target="1.1" source="1.2"
      destdir="${j2me.httpclasspath}">
      <classpath refid="j2me.coreclasspath"/>
    </wtkbuild>
  </target>

  <target name="j2meLibs" depends="compileJ2MECore,compileJ2MEHttp,compileJ2MErms">
  </target>

  <target name="midp10gui"
    depends="compileJ2MECore"
    description="Compile J2ME MIDP1.0 GUI">
    <mkdir dir="${j2me.guiclasspath}"/>
    <mkdir dir="${j2me.pre}/midp10gui"/>
    <wtkpreprocess srcdir="midp10gui" destdir="${j2me.pre}/midp10gui"
      symbols="ant:j2me,ant:cldc1.0"/>
    <wtkbuild srcdir="${j2me.pre}/midp10gui" target="1.1" source="1.2"
      cldc="false"
      destdir="${j2me.guiclasspath}">
      <classpath refid="j2me.coreclasspath"/>
    </wtkbuild>
    <jar destfile="${j2me.heclgui.jar}"
      basedir="${j2me.build}"
      excludes="stand/**,**jad,**jar,*html,*hcl,*.class"
      update="true">
    </jar>
  </target>

  <target name="midp20gui"
    description="Compile J2ME MIDP2.0 GUI">
    <mkdir dir="${j2me.guiclasspath}"/>
    <mkdir dir="${j2me.pre}/midp20gui"/>
    <wtkpreprocess srcdir="midp20gui" destdir="${j2me.pre}/midp20gui"
      symbols="ant:j2me,ant:cldc1.1"/>
    <wtkbuild srcdir="${j2me.pre}/midp20gui" target="1.1" source="1.2"
      cldc="false"
      destdir="${j2me.guiclasspath}">
      <classpath refid="j2me.coreclasspath"/>
    </wtkbuild>
    <jar destfile="${j2me.heclgui.jar}"
      basedir="${j2me.build}"
      excludes="stand/**,**jad,**jar,*html,*hcl,*.class"
      update="true">
    </jar>
  </target>

  <target name="j2melib"
    description="Stuff the j2me class files into a jar for later use
    as embedded language in external projects"
    depends="j2meLibs">

    <wtkjad jadfile="${j2me.hecl.lib.jad}" jarfile="${j2me.hecl.lib.jar}"
      name="${j2me.app}"
      version="${j2me.appversion}"
      vendor="${j2me.vendor}"
      >
      <attribute name="MicroEdition-Profile" value="MIDP-${wtk.midp.version}"/>
      <attribute name="MicroEdition-Configuration" value="CLDC-${wtk.cldc.version}"/>
    </wtkjad>
    <wtkpackage
      basedir="${j2me.build}"
      excludes="**jad,**jar,**hcl,**png,*.class,script.hcl"
      jarfile="${j2me.hecl.lib.jar}"
      jadfile="${j2me.hecl.lib.jad}"
      cldc="false"
      preverify="${preverify}"
      >

      <manifest>
	<attribute name="MIDlet-Name" value="Hecl"/>
	<attribute name="MIDlet-Vendor" value="dedasys"/>
	<attribute name="MIDlet-Version" value="1.1"/>
	<attribute name="MIDlet-Permissions" value="javax.microedition.io.Connector.http"/>
	<!--
	<attribute name="MIDlet-1" value="${j2me.app}lib, Hecl.png, ${j2me.app}lib"/>
	-->
	<attribute name="MIDlet-Jar-URL" value="${j2me.app}lib.jar"/>
	<attribute name="MicroEdition-Profile" value="MIDP-${wtk.midp.version}"/>
	<attribute name="MicroEdition-Configuration" value="CLDC-${wtk.cldc.version}"/>
      </manifest>
    </wtkpackage>
    <copy file="${j2me.hecl.lib.jar}" todir="${j2me.rel}" overwrite="true"/>
    <copy file="${j2me.hecl.lib.jar}" todir="${j2me.rel}" overwrite="true"/>
  </target>

  <target name="midlet">

    <wtkjad
      name="${j2me.app}"
      version="${j2me.appversion}"
      vendor="${j2me.vendor}"
      jadfile="${j2me.hecl.jad}"
      jarfile="${j2me.hecl.jar}">

      <midlet name="${j2me.app}" class="${j2me.entryclass}"/>
      <attribute name="MicroEdition-Profile" value="MIDP-${wtk.midp.version}"/>
      <attribute name="MicroEdition-Configuration" value="CLDC-${wtk.cldc.version}"/>
    </wtkjad>

    <condition property="midpdir" value="midp10" else="midp20">
      <equals arg1="1.0" arg2="${wtk.midp.version}"/>
    </condition>

    <copy file="${midpdir}/script.hcl" todir="${j2me.build}" overwrite="true"/>
    <copy file="${midpdir}/Hecl.png" todir="${j2me.build}" overwrite="true"/>

    <wtkpackage
      basedir="${j2me.build}"
      excludes="pre/**,**jad,**jar"
      jadfile="${j2me.hecl.jad}"
      jarfile="${j2me.hecl.jar}"
      cldc="false"
      preverify="${preverify}"
      obfuscate="${obfuscate}"
      verbose="true">

      <preserve class="Hecl { &lt;methods&gt;; }" />

      <manifest>
	<attribute name="MIDlet-Name" value="Hecl"/>
	<attribute name="MIDlet-Vendor" value="dedasys"/>
	<attribute name="MIDlet-Version" value="2.0"/>
	<attribute name="MIDlet-Permissions" value="javax.microedition.io.Connector.http"/>
	<!--
	<attribute name="MIDlet-1" value="Hecl, Hecl.png, Hecl"/>
	-->
	<attribute name="MIDlet-Jar-URL" value="Hecl.jar"/>
	<attribute name="MicroEdition-Profile" value="MIDP-${wtk.midp.version}"/>
	<attribute name="MicroEdition-Configuration" value="CLDC-${wtk.cldc.version}"/>
      </manifest>
    </wtkpackage>
    <copy file="${j2me.hecl.jad}" todir="${j2me.rel}" overwrite="true"/>
    <copy file="${j2me.hecl.jar}" todir="${j2me.rel}" overwrite="true"/>
  </target>
</project>